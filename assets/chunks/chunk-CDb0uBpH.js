import{r as a,R,j as d}from"./chunk-Btz8Rub7.js";function L(...e){return e.length===1&&e[0]?e[0]:n=>{for(let t of e)typeof t=="function"?t(n):t!=null&&(t.current=n)}}const j=()=>document.readyState==="complete"||document.readyState==="interactive",l=[];let h=!1;const E=()=>{if(j()===!1){console.error("DOMContentLoaded event has not been fired yet");return}if(h)return;h=!0;const e=document.addEventListener,n=window.addEventListener,t=new Event("DOMContentLoaded"),r=new Event("load");window.addEventListener=(o,c,s)=>{o==="DOMContentLoaded"?l.push(()=>c.call(window,t)):(o==="load"&&l.push(()=>c.call(window,r)),n.call(window,o,c,s))},document.addEventListener=(o,c,s)=>{o==="DOMContentLoaded"?l.push(()=>c.call(document,t)):e.call(document,o,c,s)}},S=()=>{for(const e of l)e();l.length=0},b={scriptTestIdPrefix:"client-"},O=e=>new Promise((n,t)=>{const r=document.createElement("script"),o=e.hasAttribute("src"),c=e.type==="module";for(const{name:s,value:i}of e.attributes)r.setAttribute(s,i);if(r.dataset.testid!==void 0&&(r.dataset.testid=`${b.scriptTestIdPrefix}${r.dataset.testid}`),o)r.addEventListener("load",()=>{n()}),r.addEventListener("error",t);else{if(c){const s=new Blob([e.innerText],{type:"text/javascript"}),i=URL.createObjectURL(s);import(i).then(n).catch(t).finally(()=>{URL.revokeObjectURL(i)});return}r.textContent=e.innerText}e.replaceWith(r),o===!1&&n()}),u=[];let f=!1;const g=async e=>{if(u.push(...e),await Promise.resolve(),!f){for(E(),f=!0;u.length>0;)await u.shift()();S(),f=!1}},C=e=>{const n=e.querySelectorAll("script"),t=[],r=[];n.forEach(o=>{(o.hasAttribute("async")?r:t).push(()=>O(o))});for(const o of r)o();g(t)},M=e=>{const{code:n,innerRef:t,...r}=e;return d.jsx("div",{ref:t,...r,style:{display:"block",padding:20},children:'Open the "Settings" panel to insert HTML code.'})},m=()=>a.useSyncExternalStore(()=>()=>{},()=>!1,()=>!0),p=e=>{if(!m())return e.children},x=e=>{const{code:n,innerRef:t,...r}=e,o=a.useRef(null),c=a.useRef(!0),s=a.useMemo(()=>({__html:n??""}),[n]);return a.useEffect(()=>{const i=o.current;i&&c.current&&(c.current=!1,C(i))},[]),d.jsx("div",{...r,ref:L(t,o),dangerouslySetInnerHTML:s})},v=e=>{const{code:n,innerRef:t,...r}=e;return d.jsx("div",{...r,ref:t,dangerouslySetInnerHTML:{__html:n??""}})},T=v,$=a.forwardRef((e,n)=>{const{code:t,executeScriptOnCanvas:r,clientOnly:o,children:c,...s}=e,{renderer:i}=a.useContext(R),w=m(),[y]=a.useState(w);return t===void 0||String(t).trim().length===0?d.jsx(M,{innerRef:n,...s}):y?o!==!0?d.jsx(v,{innerRef:n,code:t,...s}):d.jsx(p,{children:d.jsx(x,{innerRef:n,code:t,...s})}):i==="canvas"&&r!==!0?d.jsx(p,{children:d.jsx(T,{innerRef:n,code:t,...s})}):d.jsx(p,{children:d.jsx(x,{innerRef:n,code:t,...s},t)})});$.displayName="HtmlEmbed";export{$ as P};
